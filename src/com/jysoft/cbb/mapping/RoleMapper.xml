<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jysoft.cbb.dao.RoleMapper">
	<resultMap type="roleVo" id="roleVo">
		 <result property="roleId"     column="ROLE_ID"        />
		 <result property="roleName"   column="ROLE_NAME"      />
		 <result property="isDefault"  column="ROLE_ISDEFAULT" />
		 <result property="enable"     column="ENABLE"         />
		 <result property="roleDesc"   column="ROLE_DESC"      />
		 <result property="modifyDate" column="MODIFY_DATE"    />
	</resultMap>
	
	<!--获取所有角色,不分页-->
	<select id="getAll" resultMap="roleVo">
		SELECT *  FROM T_ROLE 
	</select>
	
	<!--获取所有角色，分页-->
	<select id="getAllPage" resultMap="roleVo" parameterType="roleVo">
	   SELECT * FROM (SELECT TMP_TB.*,ROWNUM ROW_ID FROM (
		SELECT *  FROM t_role ORDER BY MODIFY_DATE DESC
		 )  TMP_TB WHERE ROWNUM <![CDATA[<=]]> #{page} * #{rows} ) 
	     WHERE ROW_ID <![CDATA[>]]> (#{page} - 1) * #{rows}
	</select>
	
	<!--获取所有角色的条数-->
	<select id="getAllTotal" resultType="String">
		SELECT COUNT(*) FROM  T_ROLE
	</select>
	
	<!--根据角色id获取对应角色-->
	<select id="getRoleById" resultMap="roleVo" parameterType="roleVo">
		SELECT *  FROM T_ROLE T WHERE T.ROLE_ID = #{roleId}
	</select>
	
	<!--根据角色名称获取所有角色-->
	<select id="getRolesByName" resultMap="roleVo" parameterType="roleVo">
		SELECT *  FROM T_ROLE T WHERE T.ROLE_NAME = #{roleName}
		<if test="roleId != null and roleId != '' ">  AND T.ROLE_ID != #{roleId}</if> 
	</select>
	
	<!--删除角色-->
	<delete id="delete" parameterType="roleVo">
		DELETE FROM T_ROLE T WHERE T.ROLE_ID=#{roleId}
	</delete>
	
	<!--插入角色-->
	<insert id="insert" parameterType="roleVo">
		INSERT INTO T_ROLE(
		 ROLE_ID     
		,ROLE_NAME   
		,ROLE_ISDEFAULT
		,ENABLE      
		,ROLE_DESC 
		,MODIFY_DATE
		)VALUES(
		#{roleId},
		#{roleName},
		<if test="isDefault != null">#{isDefault},</if> 
		<if test="isDefault == null"> null,</if> 
		<if test="enable != null">#{enable},</if>
		<if test="enable == null"> null,</if>
		#{roleDesc},
		sysdate
		)
	</insert>
	
	<!--更新角色-->
	<update id="update" parameterType="roleVo">
		UPDATE T_ROLE
		<set>
			ROLE_NAME      =   #{roleName},
			ROLE_DESC      =   #{roleDesc},
			MODIFY_DATE    =   sysdate,
		</set>
		WHERE ROLE_ID      =  #{roleId}
	</update>
	
	<!--根据用户id获取所对应的角色-->
	<select id="getRolesByUserId" resultMap="roleVo" parameterType="userVo">
		SELECT T1.*
		  FROM T_ROLE T1, T_USER_ROLE T2
		 WHERE T1.ROLE_ID = T2.ROLE_ID
		   AND T2.USER_ID = #{userId}
		 ORDER BY T1.ROLE_NAME
	</select>
</mapper>